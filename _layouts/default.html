<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'es' }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{{ page.description | default: site.description }}">

    <!-- SEO Tags -->
    {% seo %}

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Inter:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/firebase-components.css' | relative_url }}">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ '/assets/images/favicon.svg' | relative_url }}">

    <!-- Theme Color -->
    <meta name="theme-color" content="#2563eb">

    <!-- Theme preference -->
    <script>
        // Check for saved theme preference or default to light mode
        const currentTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);
    </script>
</head>

<body>
    <!-- Loading spinner -->
    <div id="loading-spinner" class="loading-spinner">
        <div class="spinner"></div>
    </div>

    <!-- Skip to content for accessibility -->
    <a href="#main-content" class="skip-to-content">Saltar al contenido principal</a>

    <!-- Navigation -->
    <nav class="navbar" role="navigation" aria-label="Navegaci칩n principal">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="{{ '/' | relative_url }}" class="brand-link">
                    <i class="fas fa-brain"></i>
                    <span>{{ site.title }}</span>
                </a>
            </div>

            <div class="nav-controls">
                <!-- Search -->
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Buscar..." aria-label="B칰squeda">
                    <button id="search-btn" aria-label="Buscar">
                        <i class="fas fa-search"></i>
                    </button>
                </div>

                <!-- Theme toggle -->
                <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema">
                    <i class="fas fa-sun sun-icon" style="display: none;"></i>
                    <i class="fas fa-moon moon-icon" style="display: none;"></i>
                </button>

                <!-- Mobile menu toggle -->
                <button id="menu-toggle" class="menu-toggle" aria-label="Men칰">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <aside class="sidebar" role="complementary" aria-label="Navegaci칩n principal">
        <div class="sidebar-header">
            <h1 class="site-title"><a href="{{ '/' | relative_url }}">{{ site.title }}</a></h1>
        </div>
        <div class="sidebar-content">
            <nav class="main-nav" aria-label="Navegaci칩n de secciones">
                <ul class="nav-list">
                    {% assign sections = site.sections | sort: 'order' %}
                    {% for section in sections %}
                    {% assign section_name = section.title | downcase %}
                    {% if section_name contains 'sentido' %}
                    {% assign icon = '游눬' %}
                    {% elsif section_name contains 'obst치culo' or section_name contains 'obstaculo' %}
                    {% assign icon = '游뚾' %}
                    {% elsif section_name contains 'm칠todo' or section_name contains 'metodo' %}
                    {% assign icon = '游댧' %}
                    {% elsif section_name contains 'principio' %}
                    {% assign icon = '丘뒲잺' %}
                    {% elsif section_name contains 'conclusi칩n' or section_name contains 'conclusion' %}
                    {% assign icon = '游꿢' %}
                    {% else %}
                    {% assign icon = section.icon | default: '游늯' %}
                    {% endif %}

                    <li class="nav-item">
                        <a href="{{ section.url | relative_url }}"
                            class="nav-link {% if page.url == section.url %}active{% endif %}">
                            <span class="nav-icon">{{ icon }}</span>
                            <span class="nav-text">{{ section.title }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </nav>
        </div>
    </aside>

    <!-- Main content -->
    <main id="main-content" class="main-content" role="main">
        <!-- Progress bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <!-- Breadcrumb -->
        <nav class="breadcrumb" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="{{ '/' | relative_url }}">Inicio</a>
                </li>
                {% if page.section %}
                <li class="breadcrumb-item">
                    <span>{{ page.section }}</span>
                </li>
                {% endif %}
                {% if page.title != site.title %}
                <li class="breadcrumb-item active" aria-current="page">
                    <span>{{ page.title }}</span>
                </li>
                {% endif %}
            </ol>
        </nav>

        <!-- Content -->
        <article class="content">
            {{ content }}
        </article>

        <!-- Navigation buttons -->
        <nav class="content-nav" aria-label="Navegaci칩n de contenido">
            {% if page.previous %}
            <a href="{{ page.previous.url | relative_url }}" class="nav-btn nav-btn--prev">
                <i class="fas fa-arrow-left"></i>
                <span>{{ page.previous.title }}</span>
            </a>
            {% endif %}

            {% if page.next %}
            <a href="{{ page.next.url | relative_url }}" class="nav-btn nav-btn--next">
                <span>{{ page.next.title }}</span>
                <i class="fas fa-arrow-right"></i>
            </a>
            {% endif %}
        </nav>
    </main>

    <!-- Search results -->
    <div id="search-results" class="search-results" role="region" aria-label="Resultados de b칰squeda">
        <div class="search-results-header">
            <h3>Resultados de b칰squeda</h3>
            <button id="close-search" class="close-search" aria-label="Cerrar b칰squeda">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="search-results-content" id="search-results-content">
            <!-- Search results will be populated here -->
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Scripts -->
    <script src="{{ '/assets/js/main.js' | relative_url }}"></script>
    <script src="{{ '/firebase-config.js' | relative_url }}"></script>

    <!-- Analytics -->
    {% if site.google_analytics %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', '{{ site.google_analytics }}');
    </script>
    {% endif %}
</body>

</html>
